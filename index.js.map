{"version":3,"file":"index.js","sources":["../src/api.js","../src/main.js"],"sourcesContent":["import axios from 'axios';\n\nconst PIXABAY_BASE_URL = 'https://pixabay.com/api/';\n\nexport class PixabayClient {\n  /**\n   * @param {object} options\n   * @param {string} options.apiKey - Pixabay API key\n   * @param {number} [options.perPage=40] - Items per page (max 200, use 40 per task)\n   */\n  constructor({ apiKey, perPage = 40 }) {\n    this.apiKey = apiKey;\n    this.perPage = perPage;\n    this.page = 1;\n    this.query = '';\n\n    this.http = axios.create({\n      baseURL: PIXABAY_BASE_URL,\n      timeout: 15000,\n      params: {\n        key: this.apiKey,\n        image_type: 'photo',\n        orientation: 'horizontal',\n        safesearch: true,\n      },\n    });\n  }\n\n  setQuery(newQuery) {\n    this.query = newQuery.trim();\n  }\n\n  resetPage() {\n    this.page = 1;\n  }\n\n  incrementPage() {\n    this.page += 1;\n  }\n\n  /**\n   * Fetch images for current query and page\n   * @returns {Promise<{hits: any[], total: number, totalHits: number}>}\n   */\n  async fetchImages() {\n    if (!this.query) return { hits: [], total: 0, totalHits: 0 };\n\n    const response = await this.http.get('', {\n      params: {\n        q: this.query,\n        page: this.page,\n        per_page: this.perPage,\n      },\n    });\n    return response.data;\n  }\n}\n\n\n\n","import SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\nimport Notiflix from 'notiflix';\nimport { PixabayClient } from './api.js';\n\nconst refs = {\n  form: null,\n  queryInput: null,\n  gallery: null,\n  loadMoreBtn: null,\n  loader: null,\n  status: null,\n};\n\nconst state = {\n  currentQuery: '',\n  totalHits: 0,\n  loadedHits: 0,\n};\n\nconst client = new PixabayClient({\n  apiKey: import.meta.env.VITE_PIXABAY_KEY || '',\n  perPage: 40,\n});\n\nlet lightbox = null;\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  refs.form = document.getElementById('search-form');\n  refs.queryInput = document.getElementById('searchQuery');\n  refs.gallery = document.getElementById('gallery');\n  refs.loadMoreBtn = document.getElementById('load-more');\n  refs.loader = document.getElementById('loader');\n  refs.status = document.getElementById('status');\n\n  refs.form.addEventListener('submit', onSearchSubmit);\n  refs.loadMoreBtn.addEventListener('click', onLoadMore);\n\n  lightbox = new SimpleLightbox('.gallery a', {\n    captionsData: 'alt',\n    captionDelay: 250,\n  });\n});\n\nfunction showLoader(show) {\n  refs.loader.hidden = !show;\n}\n\nfunction showLoadMore(show) {\n  refs.loadMoreBtn.hidden = !show;\n}\n\nfunction setStatus(message) {\n  if (!message) {\n    refs.status.hidden = true;\n    refs.status.textContent = '';\n  } else {\n    refs.status.hidden = false;\n    refs.status.textContent = message;\n  }\n}\n\nfunction clearGallery() {\n  refs.gallery.innerHTML = '';\n}\n\nfunction renderImages(items) {\n  const markup = items\n    .map(\n      ({ webformatURL, largeImageURL, tags, likes, views, comments, downloads }) => `\n      <li class=\"photo-card\">\n        <a href=\"${largeImageURL}\">\n          <img src=\"${webformatURL}\" alt=\"${escapeHtml(tags)}\" loading=\"lazy\" />\n        </a>\n        <ul class=\"info\">\n          <li><b>Likes</b> ${likes}</li>\n          <li><b>Views</b> ${views}</li>\n          <li><b>Comments</b> ${comments}</li>\n          <li><b>Downloads</b> ${downloads}</li>\n        </ul>\n      </li>`\n    )\n    .join('');\n\n  refs.gallery.insertAdjacentHTML('beforeend', markup);\n  lightbox.refresh();\n}\n\nfunction escapeHtml(str) {\n  return String(str).replace(/[&<>\"]+/g, s => ({\n    '&': '&amp;',\n    '<': '&lt;',\n    '>': '&gt;',\n    '\"': '&quot;',\n  })[s]);\n}\n\nasync function onSearchSubmit(event) {\n  event.preventDefault();\n  const query = refs.queryInput.value.trim();\n  if (!query) {\n    Notiflix.Notify.info('Please enter a search term.');\n    return;\n  }\n\n  state.currentQuery = query;\n  state.loadedHits = 0;\n  state.totalHits = 0;\n  clearGallery();\n  showLoadMore(false);\n  setStatus('');\n\n  client.setQuery(query);\n  client.resetPage();\n\n  await fetchAndRender();\n}\n\nasync function onLoadMore() {\n  await fetchAndRender();\n}\n\nasync function fetchAndRender() {\n  try {\n    showLoader(true);\n    const { hits, totalHits } = await client.fetchImages();\n\n    if (client.page === 1) {\n      state.totalHits = totalHits;\n      if (totalHits === 0) {\n        Notiflix.Notify.failure('Sorry, there are no images matching your search query. Please try again.');\n        showLoadMore(false);\n        return;\n      }\n      Notiflix.Notify.success(`Hooray! We found ${totalHits} images.`);\n    }\n\n    renderImages(hits);\n    state.loadedHits += hits.length;\n\n    // Smooth scroll by two card heights\n    smoothScrollByTwoCards();\n\n    // Pagination controls\n    const hasMore = state.loadedHits < state.totalHits;\n    showLoadMore(hasMore);\n    if (!hasMore) {\n      setStatus(\"We're sorry, but you've reached the end of search results.\");\n    } else {\n      setStatus('');\n    }\n\n    client.incrementPage();\n  } catch (error) {\n    console.error(error);\n    Notiflix.Notify.failure('Something went wrong. Please try again later.');\n  } finally {\n    showLoader(false);\n  }\n}\n\nfunction smoothScrollByTwoCards() {\n  const firstCard = refs.gallery.querySelector('.photo-card');\n  if (!firstCard) return;\n  const { height } = firstCard.getBoundingClientRect();\n  window.scrollBy({ top: height * 2, behavior: 'smooth' });\n}\n\n\n"],"names":["PIXABAY_BASE_URL","PixabayClient","apiKey","perPage","axios","newQuery","refs","state","client","lightbox","onSearchSubmit","onLoadMore","SimpleLightbox","showLoader","show","showLoadMore","setStatus","message","clearGallery","renderImages","items","markup","webformatURL","largeImageURL","tags","likes","views","comments","downloads","escapeHtml","str","s","event","query","Notiflix","fetchAndRender","hits","totalHits","smoothScrollByTwoCards","hasMore","error","firstCard","height"],"mappings":"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"}